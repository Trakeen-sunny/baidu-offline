/**/ï»¿_jsload&&_jsload('poly', 'x.DOM_ATTRS={strokecolor:1,strokeweight:1,strokeopacity:1,fillcolor:1,fillopacity:1,strokelinecap:1,strokelinejoin:1,strokestyle:1,topfillcolor:1,topfillopacity:1,sidefillcolor:1,sidefillopacity:1};D.extend(x.prototype,{initialize:function(T){if(T&&this._graphMouseEvent){T.addEventListener("onmousemove",this._graphMouseEvent)}if(T&&this._graphClickEvent){T.addEventListener("onclick",this._graphClickEvent);T.addEventListener("ondblclick",this._graphClickEvent);T.addEventListener("onrightclick",this._graphClickEvent);T.addEventListener("onrightdblclick",this._graphClickEvent)}if((this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted")&&T.getRenderType()==="webgl"&&!this._config.texture){this._generateTexture()}var e=cW.prototype.initialize.call(this,T);if(this._config.enableEditing===true&&!this._config.geodesic){var i=this;setTimeout(function(){i.clearVertexs();i.addVertexs()},0)}return e},_generateTexture:function(){var hV=this._config;var T=hV.dashArray;var hU=document.createElement("canvas");var e;var hT;if(hV.strokeStyle==="dashed"){e=16;hT=e*8}else{if(hV.strokeStyle==="dotted"){e=32;hT=e*2}}hU.width=e;hU.height=hT;var i=hU.getContext("2d");i.fillStyle=hV.strokeColor;i.globalAlpha=hV.strokeOpacity;if(hV.strokeStyle==="dashed"){this._drawDashArrayTexture(i,e,hT)}else{if(hV.strokeStyle==="dotted"){this._drawDottedTexture(i,e,hT)}}this._config.texture=hU;this._config.textureSize=[e,hT]},_drawDashArrayTexture:function(hZ,hT,hV){var T=this._config;var hX=T.dashArray;if(!hX){hZ.fillRect(0,0,hT,hV/2);this._totalDashLen=T.strokeWeight*4}else{var hY=0;if(hX.length%2!==0){hX=hX.concat(hX)}for(var hU=0;hU<hX.length;hU++){hY+=hX[hU]}var e=0;for(var hU=0;hU<hX.length;hU++){var hW=hX[hU]/hY*hV;if(hU%2===0){hZ.fillRect(0,e,hT,hW)}e+=hW}this._totalDashLen=hY}},_drawDottedTexture:function(i,e,T){i.beginPath();i.arc(e/2,e/2,e/2,0,2*Math.PI);i.fill();i.closePath();this._totalDashLen=this._config.strokeWeight*2},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=bx.getDrawer(this.map);this.domElement=e.addLine()},_bind:function(){var e=this.domElement;var hT=this;function hV(h1,hZ){var hY=h1.srcElement||h1.target;var hX=fK();var i=h1.pageX?h1.pageX:(h1.clientX+hX[1]);var h3=h1.pageY?h1.pageY:(h1.clientY+hX[0]);if(h1&&hZ&&i&&h3&&hY){var h0=D.I(hY.hashCode).map;var h2=D.Dom.getOffset(h0.container);hZ.pixel=new ek(i-h2.left,h3-h2.top);hZ.point=h0.pixelToPointIn(hZ.pixel);hZ.latLng=h0.pixelToPoint(hZ.pixel);return hZ}else{return hZ}}if(e&&bx.getDrawer(this.map).getType()!=="canvas"){D.on(e,"click",function(i){hT.dispatchEvent(hV(i,new bc("onclick").inherit(i)))});D.on(e,"mousedown",function(i){hT.dispatchEvent(hV(i,new bc("onmousedown").inherit(i)))});D.on(e,"mouseup",function(i){hT.dispatchEvent(hV(i,new bc("onmouseup").inherit(i)))});D.on(e,"dblclick",function(i){hT.dispatchEvent(hV(i,new bc("ondblclick").inherit(i)))})}e=null;if(!this._binded){this._binded=true;this.enableEventListen=true;this._graphMouseEvent=function(h0){if(!hT.map){return}if(hT.map.getMapType()==="B_EARTH_MAP"){return}if(hT instanceof bp.PolylineMultipart||hT instanceof bp.Marker3D){return}if(hT.map.temp._draggingMarker){return}if(!hT.enableEventListen){return}var hX;if(h0.overlay&&h0.overlay.toString()==="Marker"){if(!h0.overlay.keepWhenMousemoveOn){if(hT._temp.ismouseout===false&&hT._temp.ismouseover===true){hT._temp.ismouseover=false;hT._temp.ismouseout=true;hX=new bc("onmouseout");hT.dispatchEvent(hX)}return}}var i=h0.point;var hZ;if(hT.toString()!=="Polyline"){hZ=hT._getInPnpoly(i)}else{hZ=hT._getProximity(i)}var hY=hZ.dist;if(hY>=0&&hY<hT._config.mouseOverTolerance){if(!hT._temp.ismouseover){hT._temp.ismouseover=true;hT._temp.ismouseout=false;hX=new bc("onmouseover")}else{hX=new bc("onmousemove");hT.map.platform.style.cursor="pointer"}}else{if(!hT._temp.ismouseout&&hT._temp.ismouseover){hT._temp.ismouseover=false;hT._temp.ismouseout=true;hX=new bc("onmouseout");hT.map.platform.style.cursor=hT.map.config.defaultCursor}}if(hX){if(hT.toString()!=="Polyline"&&hX.type==="onmousemove"&&hT._temp.ismouseover===true&&(hY===0||hY>hT._config.mouseOverTolerance)){hX.pixel=h0.pixel;hX.point=h0.point;hX.latLng=this.overlayPixelToPoint(h0.pixel)}else{hX.point=this.overlayPixelToPointIn(hZ.pixel);hX.pixel=this.pointToPixelIn(hX.point);hX.latLng=this.overlayPixelToPoint(hZ.pixel)}hT.dispatchEvent(hX)}};this._graphClickEvent=function(h0){if(!hT.map){return}if(hT.map.getMapType()==="B_EARTH_MAP"){return}if(hT instanceof bp.PolylineMultipart||hT instanceof bp.Marker3D){return}if(hT.map.temp._draggingMarker){return}if(!hT.enableEventListen){return}var hX;var i=h0.point;var hZ;if(hT.toString()!=="Polyline"){hZ=hT._getInPnpoly(i)}else{hZ=hT._getProximity(i)}var hY=hZ.dist;if(hY>=0&&hY<hT._config.mouseOverTolerance){hX=new bc(h0.type)}if(hX){if(hT.toString()!=="Polyline"&&hX.type==="onmousemove"&&hT._temp.ismouseover===true&&(hY===0||hY>hT._config.mouseOverTolerance)){hX.pixel=h0.pixel;hX.point=h0.point;hX.latLng=this.overlayPixelToPoint(h0.pixel)}else{hX.point=this.overlayPixelToPointIn(hZ.pixel);hX.pixel=this.pointToPixelIn(hX.point);hX.latLng=this.overlayPixelToPoint(hZ.pixel)}hT.dispatchEvent(hX)}};this.map.addEventListener("onmousemove",this._graphMouseEvent);var hU=["onclick","dblclick","onrightclick","onrightdblclick"];for(var T=0;T<hU.length;T++){var hW=hU[T];this.map.addEventListener(hW,this._graphClickEvent)}this.addEventListener("mouseover",function(i){if(!this.map){return}});this.addEventListener("mouseout",function(i){if(!this.map){return}});this.map.addEventListener("movestart",function(){hT.enableEventListen=false;hT._mouseEventPixels=null});this.map.addEventListener("moveend",function(){hT.enableEventListen=true});this.map.addEventListener("zoomstart",function(){hT.enableEventListen=false;hT._mouseEventPixels=null});this.map.addEventListener("zoomend",function(){hT.enableEventListen=true});this.map.on("center_changed",function(){hT._mouseEventPixels=null});this.map.on("zoom_changed",function(){hT._mouseEventPixels=null});this.map.on("load",function(){hT._mouseEventPixels=null})}},draw:function(hU){if(!this.domElement){return}var hT=this.map;if(hT.getMapType()==="B_EARTH_MAP"||hT._renderType==="webgl"){return}hU=hU||{};var T=this.points.slice(0);if(this.greatCirclePoints.length>0){T[0]=this.greatCirclePoints}var i=this._getDisplayPixels(T,hU.zoom,hU.center);if(this._drawer){this._drawer.setPath(this.domElement,i)}},_draw:function(){if(this.map){this.initialize(this.map);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}this.draw()}},_getDisplayPixels:function(hX,hY,e){var hT=this.map;var hW=[];if(hX.length==0||!this.isVisible()){return[hW]}if(hT._renderType!=="webgl"&&!this.domElement){return[hW]}var T=hX;if(!this._config.enableEditing&&this._config.enableParse){T=this._simplification(hX)}var hV=[];if(hX[0] instanceof hu){var hZ=this._toOverlayPixels(T,hY,e);hV.push(hZ.pixels);hV.isOnBack=hZ.isOnBack}else{hV.isOnBack=false;for(var hU=0;hU<T.length;hU++){var hZ=this._toOverlayPixels(T[hU],hY,e);hV.push(hZ.pixels);if(hZ.isOnBack===true){hV.isOnBack=true}}}return hV},_toOverlayPixels:function(hY,h1,e){var T=this.map;var hZ;var h0=[];var hX=T.pointToOverlayPixelIn(hY[0],{zoom:h1,center:e});h0.push(hX);if(hX.onBack){hZ=true}for(var hV=1,hU=1,hT=hY.length;hV<hT;hV++){var hW=T.pointToOverlayPixelIn(hY[hV],{zoom:h1,center:e});if(hW.onBack){hZ=true}if(!hW.equals(h0[hU-1])){h0.push(hW);hU++}}return{pixels:h0,isOnBack:hZ}},getParseCacheIndex:function(e){e=Math.floor(e);if(this._config.getParseCacheIndex){return this._config.getParseCacheIndex(e)}if(e<6){return 0}if(e<10){return 1}if(e<15){return 2}return 3},getParseTolerance:function(i,e){i=Math.floor(i);if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return x.parseTolerance[e][this.getParseCacheIndex(i)]},setPoints:function(i){this._clearCache();this.points=x.getGraphPoints(i).slice(0);this._calcBounds();this.draw();var e=new bc("onlineupdate");e.overlay=this;this.dispatchEvent(e)},setPointAt:function(T,e){if(!e||!this.points[T]){return}this._clearCache();this.points[T]=new hu(e.lng,e.lat);this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!e||!this.points[i]){return}var T=eo.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},setOptions:function(i){i=i||{};var T=this.isStyleUseTexture();for(var e in i){if(i.hasOwnProperty(e)){var hU=this._config[e];var hT=i[e];this._config[e]=hT;if(hT!==hU&&(e==="strokeColor"||e==="strokeOpacity"||e==="strokeWeight")){if(this._config.texture){this._config.texture=null}if(T){this._generateTexture()}}if(this.map){this._setDomAttribute(e.toLowerCase(),i[e])}}}},isStyleUseTexture:function(){if(!this.map){return false}if(this.map.getRenderType()!=="webgl"){return false}return this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted"},setStrokeColor:function(e){this.setOptions({strokeColor:e})},setStrokeLineCap:function(e){if(this._config){this._config.strokeLineCap=e}this._setDomAttribute("strokelinecap",e)},setStrokeLineJoin:function(e){if(this._config){this._config.strokeLineJoin=e}this._setDomAttribute("strokelinejoin",e)},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e;if(!this.map){return}this._setDomAttribute("strokeweight",e)}},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e;if(!this.map){return}this._setDomAttribute("strokeopacity",e)},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e;this._setDomAttribute("fillopacity",e)},setStrokeStyle:function(e){if(e!="solid"&&e!="dashed"&&e!="dotted"){return}this._config.strokeStyle=e;this._setDomAttribute("strokestyle",e)},setFillColor:function(e){this._config.fillColor=e||"";this._setDomAttribute("fillcolor",e)},_setDomAttribute:function(i,T){if(!x.DOM_ATTRS[i]){return}if(this._drawer){if(T===false||T===null||typeof T==="undefined"){T=""}this._drawer.setAttribute(this.domElement,i,T,this._config)}var e=new bc("onlineupdate");e.overlay=this;this.dispatchEvent(e);if(i==="strokeweight"&&this.getStrokeStyle()==="dashed"&&bx.getDrawer(this.map)&&bx.getDrawer(this.map).getType()==="svg"){this._setDomAttribute("strokestyle","dashed")}},addVertexs:function(){var hX=this;if(hX.vertexMarkers.length){return}var hY=this.getVertexPoints();var hW;for(var hV=0,hT=hY.length;hV<hT;hV++){var e=hY[hV];if(e.t){hW=e4.imgPath+"nodeT.gif"}else{hW=e4.imgPath+"node.gif"}var T=new hd(hW,new ea(11,11),{offset:new ea(5,5)});var hU=new ds(e.p,{icon:T});hU.enableDragging(true);hU.addEventListener("ondragging",function(i){hX._onMarkerDragging(i)});hU.addEventListener("ondragstart",function(i){hX._onMarkerDragstart(i)});hU.addEventListener("ondragend",function(i){hX._onMarkerDragend(i)});hU.addEventListener("onmarkerdelvertex",function(i){hX._onMarkerDelVertex(i)});hU.index=hV;hU.t=e.t;this.vertexMarkers.push(hU);this.map?this.map.addOverlay(hU):""}},clearVertexs:function(){var e;while(e=this.vertexMarkers.pop()){this.map.removeOverlay(e);e=undefined}this.vertexMarkers.length=0},getVertexPoints:function(){var hV=[];for(var hU=0,T=this.points.length;hU<T;hU++){var hW=this.points[hU];hV.push({p:hW,t:0});if(hU<T-1){var e=this.points[hU+1];var hT=new hu((hW.lng+e.lng)/2,(hW.lat+e.lat)/2);hV.push({p:hT,t:1})}}this.vertexPoints=hV;return hV},delVertex:function(e){this.map.removeOverlay(this.vertexMarkers[e]);this.vertexPoints.splice(e,1);this.vertexMarkers.splice(e,1)},_onMarkerDragging:function(i){},_onMarkerDragstart:function(T){this._editstate=false;var i=new bc("oneditstart");i.pixel=T.pixel;i.point=T.point;i.latLng=T.latLng;i.overlay=this;this.dispatchEvent(i)},_onMarkerDragend:function(hX){this.vertexPoints.length=0;this._editstate=false;if(this._temp.dashedLine){this.map.removeOverlay(this._temp.dashedLine);delete this._temp.dashedLine}if(this._temp.preTNode){this.map.removeOverlay(this._temp.preTNode);delete this._temp.preTNode}if(this._temp.nexTNode){this.map.removeOverlay(this._temp.nexTNode);delete this._temp.nexTNode}var hW=hX.currentTarget;var hY=hX.point;var T=hW.index;var hV;if(T%2!=0){T=Math.ceil(T/2);hV=this.points.slice();var hU=this.points.length-T;var hT=hV.splice(T,hU);hV[hV.length]=hY;hV=hV.concat(hT)}else{T=T/2;this.points.splice(T,1,hY);if(this instanceof aS&&this.points.length-1==T){this.points.splice(0,1,hY)}hV=this.points}this.clearVertexs();this.setPoints(hV);this.addVertexs();var i=new bc("oneditend");i.pixel=hX.pixel;i.point=hX.point;i.latLng=hX.latLng;i.overlay=this;this.dispatchEvent(i);this._mouseEventPixels=null},_onMarkerDelVertex:function(hV){if(this.toString()!=="Polyline"&&this.toString()!=="Polygon"){return}if(hV.target.type===0||hV.target.t===0){var hU=[];if(this.vertexPoints.length<4&&this.toString()==="Polyline"){return}if(this.vertexPoints.length<8&&this.toString()==="Polygon"){return}if(this.toString()==="Polygon"&&(hV.target.index===0||hV.target.index===(this.vertexPoints.length-1))){this.delVertex(this.vertexPoints.length-1);this.delVertex(0)}else{this.delVertex(hV.target.index)}for(var hT=0;hT<this.vertexPoints.length;hT++){if(this.vertexPoints[hT].t===0){hU.push(this.vertexPoints[hT].p)}}this.points=hU;if(this.points[0].lng===this.points[this.points.length-1].lng&&this.points[0].lat===this.points[this.points.length-1].lat){this.points.splice(this.points.length-1,1)}this.clearVertexs();this.setPoints(this.points);this.addVertexs();var T=new bc("oneditend");T.pixel=hV.pixel;T.point=hV.point;T.latLng=hV.latLng;T.overlay=this;this.dispatchEvent(T);this._mouseEventPixels=null}},_getInPnpoly:function(T){var hT;var hX=[];var e=this.map.pointToOverlayPixelIn(T);if(this._mouseEventPixels){hX=this._mouseEventPixels}else{if(!(this.points[0] instanceof hu)){var hW=this._getDisplayPixels(this.points);for(var hV=0;hV<hW.length;hV++){hW[hV].push(hW[hV][0]);hX=hX.concat(hW[hV])}}else{hX=this._getDisplayPixels(this.points)[0]}this._mouseEventPixels=hX}var hU=this._pixelPnpoly(e,hX);hT=hU?0:1000;return{pixel:e,dist:hT}},_getProximity:function(h4){var T,hU,h5,hX,hW,h3,h2,h1=[];var h6=this.map.pointToOverlayPixelIn(h4);if(this._mouseEventPixels){h1=this._mouseEventPixels}else{h1=this._getDisplayPixels(this.points)[0];this._mouseEventPixels=h1}var h9=h1.length;if(h9>1){for(var h7=1;h7<h9;h7++){var hZ=h1[h7-1];var id=h1[h7];if(!hZ||!id){continue}if(hZ.x!=id.x){var ic=(id.y-hZ.y)/(id.x-hZ.x);var ia=id.y-ic*id.x;h2=Math.abs(ic*h6.x+ia-h6.y)/Math.sqrt(ic*ic+1)}else{h2=Math.abs(h6.x-id.x)}var h8=Math.pow(id.y-hZ.y,2)+Math.pow(id.x-hZ.x,2);var hT=Math.pow(id.y-h6.y,2)+Math.pow(id.x-h6.x,2);var ib=Math.pow(hZ.y-h6.y,2)+Math.pow(hZ.x-h6.x,2);var hV=Math.pow(h2,2);var e=hT-hV+ib-hV;if(e>h8){h2=Math.sqrt(Math.min(hT,ib))}if((T==null)||(T>h2)){hU=Math.sqrt(ib-hV)/Math.sqrt(h8);h5=Math.sqrt(hT-hV)/Math.sqrt(h8);T=h2;h3=h7}T=Math.min(T,h2)}if(hU>1){hU=1}if(h5>1){hU=0;h5=1}var h0=h1[h3-1].x-h1[h3].x;var hY=h1[h3-1].y-h1[h3].y;hX=h1[h3-1].x-(h0*hU);hW=h1[h3-1].y-(hY*hU)}return{pixel:new ek(hX,hW),dist:T}},_pixelPnpoly:function(hU,hW){var e=hW.length;var T=0;var hV=false;for(var hT=0;hT<e;hT++){T=(hT===e-1)?0:T+1;if((hW[hT].y!==hW[T].y)&&(((hU.y>=hW[hT].y)&&(hU.y<hW[T].y))||((hU.y>=hW[T].y)&&(hU.y<hW[hT].y)))&&(hU.x<(hW[T].x-hW[hT].x)*(hU.y-hW[hT].y)/(hW[T].y-hW[hT].y)+hW[hT].x)){hV=!hV}}return hV},getMinDistance:function(i){var e=this._getProximity(i);var T=this.map.overlayPixelToPointIn(e.pixel);return this.map.getDistanceIn(i,T)},buildVertex:function(hU,h0){var hX=[];var h1=[];var h3=this.points.slice(0);var h4=[];if(this.greatCirclePoints.length>0){h3[0]=this.greatCirclePoints}var T=x.JOININDEX[this._config.strokeLineJoin];var h2=x.CAPINDEX[this._config.strokeLineCap];var hT=this.getStrokeColorForGL();var e=this._config.strokeWeight/2;var hW=this.map.getZoom();if(h3.length>500&&h3[0] instanceof hu){if(!h0&&this._lastResult){return this._lastResult}var hZ=this._getDisplayPixelsGLWithCut(h3);for(var hV=0;hV<hZ.length;hV++){if(hZ[hV].length<2){continue}if(hX.length/6+hU.getVertexCount(hZ[hV].length)>65536){h4.push([hX,h1]);hX=[];h1=[]}hU.buildData(hZ[hV],T,h2,hX,h1,hT,e)}h4.push([hX,h1]);h4.inCache=false;this._lastResult=h4;return h4}var hY=this.getParseCacheIndex(this.map.getZoom());if(h0!==true&&this._parseCacheGL[hY]){this._parseCacheGL[hY].inCache=true;return this._parseCacheGL[hY]}var hZ=this._getDisplayPixelsGL(h3);for(var hV=0;hV<hZ.length;hV++){if(hZ[hV].length<2){continue}if(hX.length/6+hU.getVertexCount(hZ[hV].length)>65536){h4.push([hX,h1]);hX=[];h1=[]}hU.buildData(hZ[hV],T,h2,hX,h1,hT,e)}h4.push([hX,h1]);this._parseCacheGL[hY]=h4;this._parseCacheGL[hY].cacheIndex=hY;return h4},ifInMapView:function(){if(!this.map){return false}if(this.map.getZoom()<5){return true}if(this._config.clip===false){return true}var e=this.map.getBoundsIn();return !!e.intersects(this.getBoundsIn())},_getDisplayPixelsGLWithCut:function(e){return this._getDisplayPixelsGL(e)},_getDisplayPixelsGL:function(hT){var hV=this.map;var hU=[];var hX=[];hU.pointsArray=hX;if(hT.length==0||!this.isVisible()){return[hU]}var hW=hT;if(!this._config.enableEditing&&this._config.enableParse){hW=this._simplification(hT)}var T=[];if(!this.hasMultipleParts){T[0]=this._toOverlayPixelsGL(hW)}else{for(var e=0;e<hW.length;e++){T.push(this._toOverlayPixelsGL(hW[e]))}}return T},_toOverlayPixelsGL:function(h0){var T=this.map;var hZ=[];var hW=[];hZ.pointsArray=hW;var e=T._polyOverlayBasePoint;var hY=[h0[0].lng-e.lng,h0[0].lat-e.lat];hZ.push(hY);hW.push(hY[0],hY[1]);for(var hV=1,hU=1,hT=h0.length;hV<hT;hV++){var hX=[h0[hV].lng-e.lng,h0[hV].lat-e.lat];if(hX[0]!==hZ[hU-1][0]||hX[1]!==hZ[hU-1][1]){hZ.push(hX);hW.push(hX[0],hX[1]);hU++}}return hZ},getStrokeColorForGL:function(){var T=this._config.strokeColor.substr(1);var i=this._config.strokeOpacity;var e;if(T.length===3){e=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),Math.floor(i*255)]}else{e=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),Math.floor(i*255)]}return e},show:function(){cW.prototype.show.call(this);var e=new bc("onlineupdate");e.action="show";e.overlay=this;this.dispatchEvent(e);this.draw();if(this._config.enableEditing===true&&!this._config.geodesic){this.addVertexs()}},hide:function(){cW.prototype.hide.call(this);var e=new bc("onlineupdate");e.action="hide";e.overlay=this;this.dispatchEvent(e);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent);this.map.removeEventListener("onclick",this._graphClickEvent);this.map.removeEventListener("ondblclick",this._graphClickEvent);this.map.removeEventListener("onrightclick",this._graphClickEvent);this.map.removeEventListener("onrightdblclick",this._graphClickEvent)}cW.prototype.remove.call(this);this._clearCache();var e=new bc("onlineupdate");e.action="remove";e.overlay=this;this.fire(e);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}}});function c3(hV,hT,h2){var hZ=false,hX=false,h0=false,h4=new ek(hV.x,hV.y),h3=new ek(hT.x,hT.y),hU=fh(h4,h2),T=fh(h3,h2),h1;var h6,h5;var hY=h2.minX,hW=h2.minY,i=h2.maxX,e=h2.maxY;do{if(hU.all==0&&T.all==0){hZ=true;h0=true}else{if((hU.all&T.all)!=0){h0=true}else{if(hU.all!=0){h1=hU}else{h1=T}if(h1.top){h6=h4.x+(h3.x-h4.x)*(hW-h4.y)/(h3.y-h4.y);h5=hW}else{if(h1.bottom){h6=h4.x+(h3.x-h4.x)*(e-h4.y)/(h3.y-h4.y);h5=e}else{if(h1.right){h5=h4.y+(h3.y-h4.y)*(i-h4.x)/(h3.x-h4.x);h6=i}else{if(h1.left){h5=h4.y+(h3.y-h4.y)*(hY-h4.x)/(h3.x-h4.x);h6=hY}}}}hX=true;if(h1.all==hU.all){h4.x=Math.round(h6);h4.y=Math.round(h5);hU=fh(h4,h2)}else{h3.x=Math.round(h6);h3.y=Math.round(h5);T=fh(h3,h2)}}}}while(!h0);if(hZ){return{pixel0:new ek(h4.x,h4.y),pixel1:new ek(h3.x,h3.y),clip:hX?true:false}}}function fh(i,hU){var T={top:0,bottom:0,right:0,left:0,all:0};var e=i.x,hT=i.y;if(hT<hU.minY){T.top=8;T.all+=T.top}else{if(hT>hU.maxY){T.bottom=4;T.all+=T.bottom}}if(e>hU.maxX){T.right=2;T.all+=T.right}else{if(e<hU.minX){T.left=1;T.all+=T.left}}return T}D.extend(a.prototype,{initialize:function(i){x.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(hT){this._clearCache();this.points=x.getGraphPoints(hT).slice(0);if(this._config.geodesic===true){this.greatCirclePoints.length=0;for(var T=0;T<this.points.length-1;T++){this.calcGreatCirclePoints(this.points[T],this.points[T+1])}}this._calcBounds();this.draw();var e=new bc("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(h5,e,ia){var ib=this.map;var hV=[];if(h5.length===0||!this.isVisible()){return[hV]}if(ib._renderType!=="webgl"&&!this.domElement){return[hV]}if(!((D.Platform.ipad||D.Platform.iphone||D.Platform.android)&&h5.length>5000)&&!this._config.enableEditing){var hW=this.getParseCacheIndex(ib.getZoom());if(this._parseCache[hW]){h5=this._parseCache[hW]}else{var T=hH(h5,this.getParseTolerance(ib.getZoom(),ib.config.coordType));h5=this._parseCache[hW]=T}}var h9;var ic=ib.pointToOverlayPixelIn(h5[0],{zoom:e,center:ia});hV.push(ic);if(ic.onBack){h9=true}for(var h6=1,h3=1,h2=h5.length;h6<h2;h6++){var hU=ib.pointToOverlayPixelIn(h5[h6],{zoom:e,center:ia});if(hU.onBack){h9=true}if(!hU.equals(hV[h3-1])){hV.push(hU);h3++}}var h8=[];var h0=Math.round(ib.offsetX);var hZ=Math.round(ib.offsetY);if(ib._renderType==="webgl"){h0=hZ=0}var hY=ib.config.drawMargin;var hX={minX:-h0-hY,minY:-hZ-hY,maxX:-h0+hY+ib.width,maxY:-hZ+hY+ib.height};for(h6=0,h2=hV.length-1;h6<h2;h6++){var h7=hV[h6];var h4=hV[h6+1];var hT=c3(h7,h4,hX);if(hT){h8.push(hT)}}var h1=[[]];for(h6=0,h2=h8.length;h6<h2;h6++){if(h8[h6].clip){h1[h1.length-1].push(h8[h6].pixel0);h1[h1.length-1].push(h8[h6].pixel1);if(h8[h6+1]&&h8[h6+1].clip){h1.push([])}}else{h1[h1.length-1].push(h8[h6].pixel0);if(h6===h8.length-1){h1[h1.length-1].push(h8[h6].pixel1)}}}h1.isOnBack=h9;return h1},_getDisplayPixelsGLWithCut:function(h3){var h8=this.map;var hV=[];if(h3.length===0||!this.isVisible()){return[hV]}if(!this._config.enableEditing){var hW=this.getParseCacheIndex(h8.getZoom());if(this._parseCache[hW]){h3=this._parseCache[hW]}else{var T=hH(h3,this.getParseTolerance(h8.getZoom(),h8.config.coordType));h3=this._parseCache[hW]=T}}var h9=h8._polyOverlayBasePoint;var e=h8.getZoomUnits();if(this._parseCacheGLRaw[hW]){hV=this._parseCacheGLRaw[hW]}else{var ia=new ek(h3[0].lng-h9.lng,h3[0].lat-h9.lat);hV.push(ia);for(var h4=1,h1=1,h0=h3.length;h4<h0;h4++){var hU=new ek(h3[h4].lng-h9.lng,h3[h4].lat-h9.lat);if(!hU.equals(hV[h1-1])){hV.push(hU);h1++}}this._parseCacheGLRaw[hW]=hV}var h7=h8.pixelToPointIn(new ek(0,h8.height));var h6=[];var hY=h8.config.drawMarginGL;var hX={minX:Math.round(-hY*e+(h7.lng-h9.lng)),minY:Math.round(-hY*e+(h7.lat-h9.lat)),maxX:Math.round((hY+h8.width)*e+(h7.lng-h9.lng)),maxY:Math.round((hY+h8.height)*e+(h7.lat-h9.lat))};for(h4=0,h0=hV.length-1;h4<h0;h4++){var h5=hV[h4];var h2=hV[h4+1];var hT=c3(h5,h2,hX);if(hT){h6.push(hT)}}var hZ=[[]];for(h4=0,h0=h6.length;h4<h0;h4++){if(h6[h4].clip){hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y]);if(h6[h4+1]&&h6[h4+1].clip){hZ.push([])}}else{hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);if(h4===h6.length-1){hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y])}}}return hZ},_getDisplayPixelsGL:function(hZ){var T=this.map;var hY=[];if(hZ.length===0||!this.isVisible()){return[hY]}if(this.greatCirclePoints.length>0){hZ=this.greatCirclePoints}if(!this._config.enableEditing){var hX=this.getParseCacheIndex(T.getZoom());if(this._parseCache[hX]){hZ=this._parseCache[hX]}else{var h0=hH(hZ,this.getParseTolerance(T.getZoom(),T.config.coordType));hZ=this._parseCache[hX]=h0}}var e=T._polyOverlayBasePoint;hY.push([hZ[0].lng-e.lng,hZ[0].lat-e.lat]);for(var hV=1,hU=1,hT=hZ.length;hV<hT;hV++){var hW=[hZ[hV].lng-e.lng,hZ[hV].lat-e.lat];if(hW[0]!==hY[hU-1][0]||hW[1]!==hY[hU-1][1]){hY.push(hW);hU++}}hY=[hY];this._addMultipleDrawPath(hY);return hY},_addMultipleDrawPath:function(T,hV,i){if(this._config.clip===true){return}var hU=this.map;hV=hV||hU.getZoom();if(hV>12&&hU.getRenderType()!=="webgl"){return}var e=i?hU.worldSize(hV):c9.WORLD_SIZE_MC;var hT=T.slice(0);D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x-e,hY.y))}else{hX.push([hY[0]-e,hY[1]])}});T.push(hX)});D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x+e,hY.y))}else{hX.push([hY[0]+e,hY[1]])}});T.push(hX)})},getParsedPoints:function(){var hW=this.map;var i=this.points;var e=[];var T=this;var hV=i.slice(0);hV=[hV];if(this.greatCirclePoints.length>0){hV=[];hV[0]=this.greatCirclePoints}D.each(hV,function(hY){var hX=hH(hY,T.getParseTolerance(hW.getZoom(),hW.config.coordType));e.push(hX)});var hU=0;if(this._bounds.sw.lng<-c9.WORLD_SIZE_MC_HALF){hU=c9.WORLD_SIZE_MC}if(this._bounds.ne.lng>c9.WORLD_SIZE_MC_HALF){hU=-c9.WORLD_SIZE_MC}if(hU===0){return e}var hT=e.slice(0);D.each(hT,function(hX){var hY=[];D.each(hX,function(hZ){hY.push(new hu(hZ.lng+hU,hZ.lat))});e.push(hY)});return e},_onMarkerDragging:function(hZ){this._editstate=true;var T=hZ.currentTarget;var h1=hZ.point;var h0=T.index;var i=this.vertexPoints;var h2;var hX=null;var hT=null;if(h0===0){var hY=i[h0+2].p;h2=[h1,hY];hX=new hu((hY.lng+h1.lng)/2,(hY.lat+h1.lat)/2);if(this.vertexMarkers[h0+1]){this.vertexMarkers[h0+1].hide()}}else{if(h0===i.length-1){var hW=i[h0-2].p;h2=[hW,h1];hX=new hu((hW.lng+h1.lng)/2,(hW.lat+h1.lat)/2);if(this.vertexMarkers[h0-1]){this.vertexMarkers[h0-1].hide()}}else{var hW=i[h0-1].p;var hY=i[h0+1].p;h2=[hW,h1,hY];if(!T.t){hW=i[h0-2].p;hY=i[h0+2].p;h2=[hW,h1,hY];hX=new hu((hW.lng+h1.lng)/2,(hW.lat+h1.lat)/2);hT=new hu((hY.lng+h1.lng)/2,(hY.lat+h1.lat)/2);if(this.vertexMarkers[h0-1]){this.vertexMarkers[h0-1].hide()}if(this.vertexMarkers[h0+1]){this.vertexMarkers[h0+1].hide()}}}}if(!this._temp.dashedLine){var hV=new a(h2,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(hV);hV.hide();this._temp.dashedLine=hV}else{this._temp.dashedLine.setPoints(h2);this._temp.dashedLine.show()}var hU=new hd(e4.imgPath+"nodeT.gif",new ea(11,11),{offset:new ea(5,5)});if(!this._temp.preTNode&&hX){this._temp.preTNode=new ds(hX,{icon:hU});this.map.addOverlay(this._temp.preTNode)}else{if(hX){this._temp.preTNode.setPoint(hX)}}if(!this._temp.nexTNode&&hT){this._temp.nexTNode=new ds(hT,{icon:hU});this.map.addOverlay(this._temp.nexTNode)}else{if(hT){this._temp.nexTNode.setPoint(hT)}}}});D.extend(eq.prototype,{initialize:function(i){x.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(i){this._clearCache();this.points=x.getGraphPoints(i).slice(0);this.points=this.calcBezierPoints(this.points,this._cps);this._calcBounds();this.draw();var e=new bc("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(h5,e,ia){var ib=this.map;var hV=[];if(h5.length===0||!this.isVisible()){return[hV]}if(ib._renderType!=="webgl"&&!this.domElement){return[hV]}if(!((D.Platform.ipad||D.Platform.iphone||D.Platform.android)&&h5.length>5000)&&!this._config.enableEditing){var hW=this.getParseCacheIndex(ib.getZoom());if(this._parseCache[hW]){h5=this._parseCache[hW]}else{var T=hH(h5,this.getParseTolerance(ib.getZoom(),ib.config.coordType));h5=this._parseCache[hW]=T}}var h9;var ic=ib.pointToOverlayPixelIn(h5[0],{zoom:e,center:ia});hV.push(ic);if(ic.onBack){h9=true}for(var h6=1,h3=1,h2=h5.length;h6<h2;h6++){var hU=ib.pointToOverlayPixelIn(h5[h6],{zoom:e,center:ia});if(hU.onBack){h9=true}if(!hU.equals(hV[h3-1])){hV.push(hU);h3++}}var h8=[];var h0=Math.round(ib.offsetX);var hZ=Math.round(ib.offsetY);if(ib._renderType==="webgl"){h0=hZ=0}var hY=ib.config.drawMargin;var hX={minX:-h0-hY,minY:-hZ-hY,maxX:-h0+hY+ib.width,maxY:-hZ+hY+ib.height};for(h6=0,h2=hV.length-1;h6<h2;h6++){var h7=hV[h6];var h4=hV[h6+1];var hT=c3(h7,h4,hX);if(hT){h8.push(hT)}}var h1=[[]];for(h6=0,h2=h8.length;h6<h2;h6++){if(h8[h6].clip){h1[h1.length-1].push(h8[h6].pixel0);h1[h1.length-1].push(h8[h6].pixel1);if(h8[h6+1]&&h8[h6+1].clip){h1.push([])}}else{h1[h1.length-1].push(h8[h6].pixel0);if(h6===h8.length-1){h1[h1.length-1].push(h8[h6].pixel1)}}}h1.isOnBack=h9;return h1},_getDisplayPixelsGLWithCut:function(h3){var h8=this.map;var hV=[];if(h3.length===0||!this.isVisible()){return[hV]}if(!this._config.enableEditing){var hW=this.getParseCacheIndex(h8.getZoom());if(this._parseCache[hW]){h3=this._parseCache[hW]}else{var T=hH(h3,this.getParseTolerance(h8.getZoom(),h8.config.coordType));h3=this._parseCache[hW]=T}}var h9=h8._polyOverlayBasePoint;var e=h8.getZoomUnits();if(this._parseCacheGLRaw[hW]){hV=this._parseCacheGLRaw[hW]}else{var ia=new ek(h3[0].lng-h9.lng,h3[0].lat-h9.lat);hV.push(ia);for(var h4=1,h1=1,h0=h3.length;h4<h0;h4++){var hU=new ek(h3[h4].lng-h9.lng,h3[h4].lat-h9.lat);if(!hU.equals(hV[h1-1])){hV.push(hU);h1++}}this._parseCacheGLRaw[hW]=hV}var h7=h8.pixelToPointIn(new ek(0,h8.height));var h6=[];var hY=h8.config.drawMarginGL;var hX={minX:Math.round(-hY*e+(h7.lng-h9.lng)),minY:Math.round(-hY*e+(h7.lat-h9.lat)),maxX:Math.round((hY+h8.width)*e+(h7.lng-h9.lng)),maxY:Math.round((hY+h8.height)*e+(h7.lat-h9.lat))};for(h4=0,h0=hV.length-1;h4<h0;h4++){var h5=hV[h4];var h2=hV[h4+1];var hT=c3(h5,h2,hX);if(hT){h6.push(hT)}}var hZ=[[]];for(h4=0,h0=h6.length;h4<h0;h4++){if(h6[h4].clip){hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y]);if(h6[h4+1]&&h6[h4+1].clip){hZ.push([])}}else{hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);if(h4===h6.length-1){hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y])}}}return hZ},_getDisplayPixelsGL:function(hZ){var T=this.map;var hY=[];if(hZ.length===0||!this.isVisible()){return[hY]}if(this.greatCirclePoints.length>0){hZ=this.greatCirclePoints}if(!this._config.enableEditing){var hX=this.getParseCacheIndex(T.getZoom());if(this._parseCache[hX]){hZ=this._parseCache[hX]}else{var h0=hH(hZ,this.getParseTolerance(T.getZoom(),T.config.coordType));hZ=this._parseCache[hX]=h0}}var e=T._polyOverlayBasePoint;hY.push([hZ[0].lng-e.lng,hZ[0].lat-e.lat]);for(var hV=1,hU=1,hT=hZ.length;hV<hT;hV++){var hW=[hZ[hV].lng-e.lng,hZ[hV].lat-e.lat];if(hW[0]!==hY[hU-1][0]||hW[1]!==hY[hU-1][1]){hY.push(hW);hU++}}hY=[hY];this._addMultipleDrawPath(hY);return hY},_addMultipleDrawPath:function(T,hV,i){if(this._config.clip===true){return}var hU=this.map;hV=hV||hU.getZoom();if(hV>12&&hU.getRenderType()!=="webgl"){return}var e=i?hU.worldSize(hV):c9.WORLD_SIZE_MC;var hT=T.slice(0);D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x-e,hY.y))}else{hX.push([hY[0]-e,hY[1]])}});T.push(hX)});D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x+e,hY.y))}else{hX.push([hY[0]+e,hY[1]])}});T.push(hX)})},});D.extend(fm.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);if(this._config.geodesic===true){this.calcGreatCirclePoints(eo.convertMC2LL(this.points[0][0]),eo.convertMC2LL(this.points[0][1]))}this._calcBounds()},_getDisplayPixels:function(e,hW,hT){var hV=this.map;var T=[];var i=this;var hU=e.slice(0);if(this.greatCirclePoints.length>0){hU[0]=this.greatCirclePoints}D.each(hU,function(hY,hX){var hZ=i._getEachDisplayPixels(hY,hX,hW,hT);D.each(hZ,function(h0){T.push(h0)})});this._addMultipleDrawPath(T,hW,true);return T},_addMultipleDrawPath:function(T,hV,i){if(this._config.clip===true){return}var hU=this.map;hV=hV||hU.getZoom();if(hV>12&&hU.getRenderType()!=="webgl"){return}var e=i?hU.worldSize(hV):c9.WORLD_SIZE_MC;var hT=T.slice(0);D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x-e,hY.y))}else{hX.push([hY[0]-e,hY[1]])}});T.push(hX)});D.each(hT,function(hW){var hX=[];D.each(hW,function(hY){if(hY.x){hX.push(new ek(hY.x+e,hY.y))}else{hX.push([hY[0]+e,hY[1]])}});T.push(hX)})},_getDisplayPixelsGL:function(e){var T=[];var i=this;var hT=e.slice(0);if(this.greatCirclePoints.length>0){hT[0]=this.greatCirclePoints}D.each(hT,function(hV,hU){var hW=i._getEachDisplayPixelsGL(hV,hU);D.each(hW,function(hX){T.push(hX)})});this._addMultipleDrawPath(T);return T},_getEachDisplayPixels:function(h3,hX,hW,h0){var e=this.map;var h2=[];if(h3.length===0||!this.domElement||!this.isVisible()){return[h2]}h3=this._simplification(h3,hX);var h1;var hZ=e.pointToOverlayPixelIn(h3[0],{zoom:hW,center:h0});h2.push(hZ);if(hZ.onBack){h1=true}for(var hV=1,hT=1,T=h3.length;hV<T;hV++){var hY=e.pointToOverlayPixelIn(h3[hV],{zoom:hW,center:h0});if(hY.onBack){h1=true}if(!hY.equals(h2[hT-1])){h2.push(hY);hT++}}if(e.getZoom()<5||this._config.clip===false){return[h2]}var hU=this._clipLine(h2);hU.isOnBack=h1;return hU},_simplification:function(T,i){if(this._config.enableEditing){return T}var hU=this.map;var hT=this.getParseCacheIndex(hU.getZoom());if(this._parseCache[hT]&&this._parseCache[hT][i]){return this._parseCache[hT][i]}else{var e=hH(T,this.getParseTolerance(hU.getZoom(),hU.config.coordType));if(!this._parseCache[hT]){this._parseCache[hT]=[]}this._parseCache[hT][i]=e;return e}},_clipLine:function(hT){var e=this.map;var hZ=[];var h2=Math.round(e.offsetX);var h1=Math.round(e.offsetY);var h3=e.config.drawMargin;var hV={minX:-h2-h3,minY:-h1-h3,maxX:-h2+h3+e.width,maxY:-h1+h3+e.height};for(var hW=0,T=hT.length-1;hW<T;hW++){var hY=hT[hW];var hX=hT[hW+1];var h0=c3(hY,hX,hV);if(h0){hZ.push(h0)}}var hU=[[]];for(var hW=0,T=hZ.length;hW<T;hW++){if(hZ[hW].clip){hU[hU.length-1].push(hZ[hW].pixel0);hU[hU.length-1].push(hZ[hW].pixel1);if(hZ[hW+1]&&hZ[hW+1].clip){hU.push([])}}else{hU[hU.length-1].push(hZ[hW].pixel0);if(hW===hZ.length-1){hU[hU.length-1].push(hZ[hW].pixel1)}}}return hU},_getEachDisplayPixelsGL:function(hZ,hW){var T=this.map;var hY=[];if(hZ.length===0||!this.isVisible()){return[hY]}hZ=this._simplification(hZ,hW);if(this._config.clip===true){return this._clipLineGL(hZ,hW)}var e=T._polyOverlayBasePoint;hY.push([hZ[0].lng-e.lng,hZ[0].lat-e.lat]);for(var hV=1,hU=1,hT=hZ.length;hV<hT;hV++){var hX=[hZ[hV].lng-e.lng,hZ[hV].lat-e.lat];if(hX[0]!==hY[hU-1][0]||hX[1]!==hY[hU-1][1]){hY.push(hX);hU++}}return[hY]},_clipLineGL:function(h3,hW){var h8=this.map;var hV=this.getParseCacheIndex(h8.getZoom());var h9=h8._polyOverlayBasePoint;var hU=[];if(this._parseCacheGLRaw[hV]&&this._parseCacheGLRaw[hV][hW]){hU=this._parseCacheGLRaw[hV][hW]}else{var ia=new ek(h3[0].lng-h9.lng,h3[0].lat-h9.lat);hU.push(ia);for(var h4=1,h1=1,h0=h3.length;h4<h0;h4++){var hT=new ek(h3[h4].lng-h9.lng,h3[h4].lat-h9.lat);if(!hT.equals(hU[h1-1])){hU.push(hT);h1++}}if(!this._parseCacheGLRaw[hV]){this._parseCacheGLRaw[hV]=[]}this._parseCacheGLRaw[hV][hW]=hU}var e=h8.getZoomUnits();var h7=h8.pixelToPointIn(new ek(0,h8.height));var h6=[];var hY=h8.config.drawMarginGL;var hX={minX:Math.round(-hY*e+(h7.lng-h9.lng)),minY:Math.round(-hY*e+(h7.lat-h9.lat)),maxX:Math.round((hY+h8.width)*e+(h7.lng-h9.lng)),maxY:Math.round((hY+h8.height)*e+(h7.lat-h9.lat))};for(h4=0,h0=hU.length-1;h4<h0;h4++){var h5=hU[h4];var h2=hU[h4+1];var T=c3(h5,h2,hX);if(T){h6.push(T)}}var hZ=[[]];for(h4=0,h0=h6.length;h4<h0;h4++){if(h6[h4].clip){hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y]);if(h6[h4+1]&&h6[h4+1].clip){hZ.push([])}}else{hZ[hZ.length-1].push([h6[h4].pixel0.x,h6[h4].pixel0.y]);if(h4===h6.length-1){hZ[hZ.length-1].push([h6[h4].pixel1.x,h6[h4].pixel1.y])}}}return hZ},getParsedPoints:function(){var hW=this.map;var i=this.points;var e=[];var T=this;var hV=i.slice(0);if(this.greatCirclePoints.length>0){hV[0]=this.greatCirclePoints}D.each(hV,function(hY){var hX=hH(hY,T.getParseTolerance(hW.getZoom(),hW.config.coordType));e.push(hX)});var hU=0;if(this._bounds.sw.lng<-c9.WORLD_SIZE_MC_HALF){hU=c9.WORLD_SIZE_MC}if(this._bounds.ne.lng>c9.WORLD_SIZE_MC_HALF){hU=-c9.WORLD_SIZE_MC}if(hU===0){return e}var hT=e.slice(0);D.each(hT,function(hX){var hY=[];D.each(hX,function(hZ){hY.push(new hu(hZ.lng+hU,hZ.lat))});e.push(hY)});console.log(e);return e},setPointAt:function(T,e,hT){hT=hT||0;if(!e||!this.points[hT][T]||!this.points[hT][T]){return}this._clearCache();this.points[hT][T]=new hu(e.lng,e.lat);if(this._config.geodesic===true){this.calcGreatCirclePoints(eo.convertMC2LL(this.points[hT][0]),eo.convertMC2LL(this.points[hT][1]))}this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},calcGreatCirclePoints:function(hT,T){if(hT.equals(T)){return}var e=eo.getDistance(dL(hT.lng),dL(hT.lat),dL(T.lng),dL(T.lat));if(e<250000){return}this.greatCirclePoints.length=0;var hX=Math.round(e/150000);var h1=this.calcAngularDistance(hT,T);this.greatCirclePoints.push(this.points[0][0]);var h0=hT.lng;var hZ=this.points[0][0];for(var hU=0;hU<hX;hU++){var hW=this.calcMiddlePoint(hT,T,hU/hX,h1);var hY=eo.convertLL2MC(hW);var hV=hY.lng;var h2=bQ(hY,hZ);if(h2>30037726){if(hY.lng<hZ.lng){hY.lng+=c9.WORLD_SIZE_MC}else{hY.lng-=c9.WORLD_SIZE_MC}}this.greatCirclePoints.push(hY);hZ=hY}this.greatCirclePoints.push(this.points[0][1]);var h2=bQ(this.points[0][1],hZ);if(h2>30037726){if(this.points[0][1].lng<hZ.lng){this.points[0][1].lng+=c9.WORLD_SIZE_MC}else{this.points[0][1].lng-=c9.WORLD_SIZE_MC}}},calcMiddlePoint:function(h0,hZ,h1,h5){var hU=h0.lat;var hT=hZ.lat;var h4=h0.lng;var h2=hZ.lng;var h6=dL(hU);var h3=dL(hT);var i=dL(h4);var e=dL(h2);var h8=Math.sin((1-h1)*h5)/Math.sin(h5);var h7=Math.sin(h1*h5)/Math.sin(h5);var hX=h8*Math.cos(h6)*Math.cos(i)+h7*Math.cos(h3)*Math.cos(e);var hW=h8*Math.cos(h6)*Math.sin(i)+h7*Math.cos(h3)*Math.sin(e);var hV=h8*Math.sin(h6)+h7*Math.sin(h3);var T=Math.atan2(hV,Math.sqrt(Math.pow(hX,2)+Math.pow(hW,2)));var hY=Math.atan2(hW,hX);return new hu(df(hY),df(T))},calcAngularDistance:function(hU,i){var hV=dL(hU.lat);var hT=dL(i.lat);var T=dL(hU.lng);var e=dL(i.lng);return Math.acos(Math.sin(hV)*Math.sin(hT)+Math.cos(hV)*Math.cos(hT)*Math.cos(Math.abs(e-T)))}});D.extend(aS.prototype,{initialize:function(i){x.prototype.initialize.call(this,i);var e=this._config;this.setOptions({strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,fillColor:e.fillColor,strokeOpacity:e.strokeOpacity,fillOpacity:e.fillOpacity});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new hu(e.lng,e.lat);this.points[T]=new hu(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new hu(e.lng,e.lat)}this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!this._userPoints[i]){return}var T=eo.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},_onMarkerDragging:function(h0){this._editstate=true;var hT=h0.currentTarget;var h2=h0.point;var h1=hT.index;var i=this.vertexPoints;var h4;var hX=i[2].p;var h3=i[i.length-2].p;var hY=null;var T=null;if(h1===0){var hZ=i[h1+2].p;h4=[h3,h2,hZ];if(!hT.t){hY=new hu((h3.lng+h2.lng)/2,(h3.lat+h2.lat)/2);T=new hu((hZ.lng+h2.lng)/2,(hZ.lat+h2.lat)/2)}}else{if(h1===i.length-1){var hW=i[h1-2].p;h4=[hW,h2,hX];if(!hT.t){hY=new hu((hW.lng+h2.lng)/2,(hW.lat+h2.lat)/2);T=new hu((hX.lng+h2.lng)/2,(hX.lat+h2.lat)/2)}}else{var hW=i[h1-1].p;var hZ=i[h1+1].p;h4=[hW,h2,hZ];if(!hT.t){hW=i[h1-2].p;hZ=i[h1+2].p;h4=[hW,h2,hZ];hY=new hu((hW.lng+h2.lng)/2,(hW.lat+h2.lat)/2);T=new hu((hZ.lng+h2.lng)/2,(hZ.lat+h2.lat)/2);if(this.vertexMarkers[h1-1]){this.vertexMarkers[h1-1].hide()}if(this.vertexMarkers[h1+1]){this.vertexMarkers[h1+1].hide()}}}}if(!this._temp.dashedLine){var hV=new a(h4,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(hV);this._temp.dashedLine=hV}else{this._temp.dashedLine.setPoints(h4)}var hU=new hd(e4.imgPath+"nodeT.gif",new ea(11,11),{offset:new ea(5,5)});if(!this._temp.preTNode&&hY){this._temp.preTNode=new ds(hY,{icon:hU});this.map.addOverlay(this._temp.preTNode)}else{if(hY){this._temp.preTNode.setPoint(hY)}}if(!this._temp.nexTNode&&T){this._temp.nexTNode=new ds(T,{icon:hU});this.map.addOverlay(this._temp.nexTNode)}else{if(T){this._temp.nexTNode.setPoint(T)}}},getFillStyleForGL:function(){var T=this._config.fillColor.substr(1);var e=this._config.fillOpacity;var i;if(T.length===3){i=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),e]}else{i=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),e]}this._fillStyleInfoForGL=i.join(",");return this._fillStyleInfoForGL},buildFillVertex:function(hW){var h0=[];var hY=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[hY]){return this._areaCacheGL[hY]}var hZ=this._getDisplayPixelsGL(this.points);if(hZ.pointsArray&&hZ.pointsArray.length<3){this._areaCacheGL[hY]=[[],h0];return this._areaCacheGL[hY]}var hU;var hV=[];var hT=0;for(var T=0;T<hZ.length;T++){if(T>0){hT+=hZ[T-1].length}hU=hW(hZ[T].pointsArray,null,null,hT);for(var e=0,hX=hU.length;e<hX;e+=3){h0.push(hU[e],hU[e+1],hU[e+2])}hV=hV.concat(hZ[T].pointsArray)}var h1=[new Float32Array(hV),new Uint16Array(h0)];this._areaCacheGL[hY]=h1;return h1}});D.extend(f9.prototype,{initialize:function(e){aS.prototype.initialize.call(this,e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return this.domElement},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=bx.getDrawer(this.map);this.domElement=e.addStandardCircle()},draw:function(i){if(!this.domElement){return}i=i||{};var T=this.getDisplayGeometry(i.center,i.zoom);if(this._drawer){this._drawer.setStandardCircleGeometry(this.domElement,T)}},getDisplayGeometry:function(e,i){var T=this.map.pointToOverlayPixelIn(this.point,{zoom:i,center:e});var hU=Math.round(this._radiusMercator/this.map.getZoomUnits(i));var hT={cx:T.x,cy:T.y,radius:hU};return hT},setPoint:function(e,T){if(!e){return}this._clearCache();if(!T){this.vertexPoints=null}this.point=e;this.latLng=eo.convertMC2LL(e);this.points=this._getPerimeterPoints(e,this.radius);this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setRadius:function(e,T){this._clearCache();if(!T){this.vertexPoints=null}this.radius=Math.abs(e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getParseTolerance:function(i,e){if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return f9.parseTolerance[e][this.getParseCacheIndex(i)]},_onMarkerDragging:function(hW){var hU;var hY;var hZ;var i=this.map;this._editstate=true;var hT=hW.currentTarget;var hX=hT.index;var T=this.vertexPoints;var hV=T[0].p;var h0=T[T.length-1].p;if(hX==0){hY=hT.point;hZ=h0}else{hY=hV;hZ=hT.point}hU=eo.getDistanceByMC(hY,hZ);this.setRadius(hU,true);this.setCenterIn(hY,true)},_onMarkerDragend:function(hU){this._editstate=false;var hT=hU.currentTarget;var T=hT.index;this.vertexPoints[0]={p:this.point,t:0};if(T==1){this.vertexPoints[1]={p:hT.point,t:0}}this.clearVertexs();this.addVertexs();var i=new bc("oneditend");i.pixel=hU.pixel;i.point=hU.point;i.latLng=hU.latLng;i.overlay=this;this.dispatchEvent(i)},getVertexPoints:function(){if(!this.vertexPoints){var e=[];e.push({p:this.point,t:0});e.push({p:this.points[Math.floor(this.points.length*3/4)],t:0});this.vertexPoints=e}return this.vertexPoints}});D.extend(bt.prototype,{initialize:function(i){x.prototype.initialize.call(this,i);var e=this._config;this.setOptions({topFillColor:e.topFillColor,topFillOpacity:e.topFillOpacity,sideFillColor:e.sideFillColor,sideFillOpacity:e.sideFillOpacity,altitude:e.altitude});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new hu(e.lng,e.lat);this.points[T]=new hu(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new hu(e.lng,e.lat)}this._calcBounds();this.draw();var i=new bc("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getFillStyleForGL:function(){var i=this._config.topFillColor.substr(1);var hU=this._config.topFillOpacity;var T=this._config.sideFillColor.substr(1);var hT=this._config.sideFillOpacity;var e;var hV;if(i.length===3){e=[parseInt(i.substr(0,1)+i.substr(0,1),16),parseInt(i.substr(1,1)+i.substr(1,1),16),parseInt(i.substr(2,1)+i.substr(2,1),16),hU*255]}else{e=[parseInt(i.substr(0,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(4,2),16),hU*255]}if(T.length===3){hV=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),hT*255]}else{hV=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),hT*255]}return{top:e,side:hV}},buildFillVertex:function(hV,ig){var hU=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[hU]&&!ig){return this._areaCacheGL[hU]}var ij=this._getDisplayPixelsGL(this.points);if(ij.pointsArray&&ij.pointsArray.length<3){this._areaCacheGL[hU]={vertex:[],index:[]};return this._areaCacheGL[hU]}var id=this.getFillStyleForGL();var h6=id.top;var ia=id.side;var hZ=this._config.altitude;var io=[0,0,1];var h1=[];var T=[];var ic=0;for(var ih=0;ih<ij.length;ih++){if(ih>0){ic+=(ij[ih-1].length-1)*5}var h9=ij[ih].pointsArray;h9.splice(-2,2);var ip=this.getClockwise(h9);if(ip){h9=this.rev(h9)}for(var ik=0;ik<h9.length;ik+=2){h1.push([h9[ik],h9[ik+1],hZ,io[0],io[1],io[2],h6[0],h6[1],h6[2],h6[3]])}var e=hV(h9,null,null,ic);for(var ik=0,h4=e.length;ik<h4;ik+=3){T.push(e[ik],e[ik+1],e[ik+2])}for(var ik=0,ib=h9.length;ik<ib;ik+=2){var h0=h9[ik];var hY=h9[ik+1];var h8=[h0,hY,0];var h7=[h0,hY,hZ];var hT=ik+2;var hX=ik+3;if(ik===ib-2){hT=0;hX=1}var im=h9[hT];var il=h9[hX];var h5=[im,il,0];var h3=[im,il,hZ];var ii=[h5[0]-h8[0],h5[1]-h8[1],h5[2]-h8[2]];var ie=[h7[0]-h8[0],h7[1]-h8[1],h7[2]-h8[2]];var io=[];vec3.cross(io,ii,ie);h8.push(io[0],io[1],io[2]);h7.push(io[0],io[1],io[2]);h5.push(io[0],io[1],io[2]);h3.push(io[0],io[1],io[2]);h8.push(ia[0],ia[1],ia[2],ia[3]);h7.push(ia[0],ia[1],ia[2],ia[3]);h5.push(ia[0],ia[1],ia[2],ia[3]);h3.push(ia[0],ia[1],ia[2],ia[3]);var hW=h1.length;h1.push(h8);h1.push(h7);h1.push(h5);h1.push(h3);T.push(hW,hW+2,hW+3,hW,hW+3,hW+1)}}var h2={vertex:this.convertBuilding3dToTypedArray(h1),index:new Uint16Array(T)};this._areaCacheGL[hU]=h2;return h2},getClockwise:function(hZ){var hV=hZ.length;if(hV<6){return false}var hT=hZ[hV-2];var hY=hZ[hV-1];var T=hZ[0];var hX=hZ[1];var e=hZ[2];var hW=hZ[3];for(var hU=2;hU<hV;hU+=2){if(hZ[hU]>T){hT=hZ[hU-2];hY=hZ[hU-1];T=hZ[hU];hX=hZ[hU+1];if(hU+2>=hV){e=hZ[0];hW=hZ[1]}else{e=hZ[hU+2];hW=hZ[hU+3]}}}return((T-hT)*(hW-hX)-(hX-hY)*(e-T)<0)},rev:function(hT){var e=[];for(var T=hT.length-1;T>=0;T-=2){e[hT.length-1-T]=hT[T-1];e[hT.length-1-T+1]=hT[T]}return e},convertBuilding3dToTypedArray:function(hW){var T=hW.length;var hT=new Float32Array(T*7);var hV=new DataView(hT.buffer);var e=0;for(var hU=0;hU<hW.length;hU++){e=hU*7;hT[e+0]=hW[hU][0];hT[e+1]=hW[hU][1];hT[e+2]=hW[hU][2];hT[e+3]=hW[hU][3];hT[e+4]=hW[hU][4];hT[e+5]=hW[hU][5];hV.setUint8(e*4+24,hW[hU][6]);hV.setUint8(e*4+25,hW[hU][7]);hV.setUint8(e*4+26,hW[hU][8]);hV.setUint8(e*4+27,hW[hU][9])}return hT}});D.extend(dX.prototype,{initialize:function(e){x.prototype.initialize.call(this,e);return this.domElement},getFillStyleForGL:function(){if(!this._config.url){return}switch(this._config.type){case"image":var e={type:"image",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"video":var e={type:"video",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"canvas":var e={type:"canvas",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break}return this._fillStyleInfoForGL},buildFillVertex:function(hW){var hZ=[];var hY=this._getDisplayPixelsGL(this.points);var hU;var hV=[];var hT=0;for(var T=0;T<hY.length;T++){if(T>0){hT+=hY[T-1].length}hU=hW(hY[T].pointsArray,null,null,hT);for(var e=0,hX=hU.length;e<hX;e+=3){hZ.push(hU[e],hU[e+1],hU[e+2])}hV=hV.concat(hY[T].pointsArray)}var h0=[new Float32Array(hV),new Uint16Array(hZ)];return h0}});function cX(e){this._map=e;this._canvasAttrName={strokeweight:"lineWidth",strokecolor:"strokeStyle",fillcolor:"fillStyle",strokeopacity:"globalAlpha",fillopacity:"globalAlpha"};this._type="canvas"}cX.prototype=new dW();var b2=cX.prototype;b2.addLine=function(){var i=U("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};b2.setPath=function(T,i){if(!T){return}var e=T.getContext("2d");this._setCanvasPosition(T);this._clearCanvas(e);var hU=parseInt(T.style.top);var hT=parseInt(T.style.left);e.beginPath();D.each(i,function(hX){if(hX.length===0){return}e.moveTo(hX[0].x-hT,hX[0].y-hU);for(var hW=1,hV=hX.length;hW<hV;hW++){e.lineTo(hX[hW].x-hT,hX[hW].y-hU)}});this._drawCanvas(T)};b2.setAttribute=function(hT,i,hU){if(!hT){return}var e=hT.getContext("2d");var T=this._getAttributeName(i);if(T){e[T]=hU}hT.setAttribute("_"+i,hU||"");e.save();this._clearCanvas(e);this._drawCanvas(hT)};b2._getAttributeName=function(e){return this._canvasAttrName[e]||e};b2._setCanvasPosition=function(hU){var i=this._map;var hZ=i.config.drawMargin;var T=i.width+2*hZ;var hW=i.height+2*hZ;var hT=-i.offsetX-hZ;var hV=-i.offsetY-hZ;var hY=hU.getContext("2d");var hX={strokeStyle:hY.strokeStyle,fillStyle:hY.fillStyle,globalAlpha:hY.globalAlpha,lineWidth:hY.lineWidth,lineCap:"round",lineJoin:"round"};hU.setAttribute("width",T);hU.setAttribute("height",hW);for(var e in hX){hY[e]=hX[e]}hY.save();var h0=hU.style;h0.top=hV+"px";h0.left=hT+"px"};b2._clearCanvas=function(e){e.clearRect(0,0,9999,9999)};b2._drawCanvas=function(i){var e=i.getContext("2d");e.globalAlpha=i.getAttribute("_fillopacity");if(e.globalAlpha!=0&&i.getAttribute("_fillcolor")){e.fill()}e.globalAlpha=i.getAttribute("_strokeopacity");if(e.globalAlpha!==0&&i.getAttribute("_strokecolor")){e.stroke()}};b2.addStandardCircle=function(){var i=U("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};b2.setStandardCircleGeometry=function(hT,hW){if(!hT){return}var T=hT.getContext("2d");this._setCanvasPosition(hT);this._clearCanvas(T);var hV=parseInt(hT.style.top);var hU=parseInt(hT.style.left);var i=hW.cx-hU;var hX=hW.cy-hV;var e=hW.radius;T.beginPath();T.arc(i,hX,e,0,Math.PI*2);this._drawCanvas(hT)};function dW(){}DrawerPrototype=dW.prototype;DrawerPrototype.setPalette=function(){};DrawerPrototype.addLine=function(){throw"addLineæ¥å£æ²¡æå®ç°"};DrawerPrototype.setAttribute=function(){throw"setAttributeæ¥å£æ²¡æå®ç°"};DrawerPrototype.setPath=function(){throw"setPathæ¥å£æ²¡æå®ç°"};DrawerPrototype.getType=function(){return this._type};var bx={getDrawer:function(e){if(e._renderType==="webgl"){return null}if(!bx["_"+e.hashCode]){bx["_"+e.hashCode]={}}switch(e.config.drawer){case BMAP_SVG_DRAWER:return bx.getSvgDrawer(e);case BMAP_VML_DRAWER:return bx.getVmlDrawer(e);case BMAP_CANVAS_DRAWER:return bx.getCanvasDrawer(e);default:break}if(bx.isSupportSvg()){return bx.getSvgDrawer(e)}if(bx.isSupportVml()){return bx.getVmlDrawer(e)}if(bx.isSupportCanvas()){return bx.getCanvasDrawer(e)}},getSvgDrawer:function(e){if(!bx["_"+e.hashCode]._svgDrawer){bx["_"+e.hashCode]._svgDrawer=new fV(e)}return bx["_"+e.hashCode]._svgDrawer},getVmlDrawer:function(e){if(!bx["_"+e.hashCode]._vmlDrawer){bx["_"+e.hashCode]._vmlDrawer=new hz(e)}return bx["_"+e.hashCode]._vmlDrawer},getCanvasDrawer:function(e){if(!bx["_"+e.hashCode]._canvasDrawer){bx["_"+e.hashCode]._canvasDrawer=new cX(e)}return bx["_"+e.hashCode]._canvasDrawer},isSupportVml:function(){if(typeof bx.supportVml!="undefined"){return bx.supportVml}var T=document.body.appendChild(U("div"));T.innerHTML=\'<v:shape id="vml_tester1" adj="1" />\';var i=T.firstChild;if(!i.style){return false}i.style.behavior="url(#default#VML)";var e=i?typeof i.adj=="object":true;T.parentNode.removeChild(T);bx.supportVml=e;return e},isSupportSvg:function(){if(typeof bx.supportSvg=="undefined"){bx.supportSvg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}return bx.supportSvg},isSupportCanvas:function(){if(typeof bx.supportCanvas=="undefined"){bx.supportCanvas=!!U("canvas").getContext}return bx.supportCanvas}};bp.DrawerSelector=bx;function fV(e){this._map=e;this.SVG_NS="http://www.w3.org/2000/svg";this._svgAttrName={strokeweight:"stroke-width",strokecolor:"stroke",fillcolor:"fill",strokeopacity:"stroke-opacity",fillopacity:"fill-opacity",strokestyle:"stroke-dasharray",strokelinecap:"stroke-linecap",strokelinejoin:"stroke-linejoin"};this._svg=this._createSvg();this._type="svg"}fV.prototype=new dW();var bE=fV.prototype;bE._createSvg=function(){var e=this._svg=U("svg",{},this.SVG_NS);e.setAttribute("version","1.1");e.setAttribute("type","system");var i=e.style;i.position="absolute";i.MozUserSelect="none";this.setPalette();this._map.getPanes().mapPane.appendChild(e);return e};bE.setPalette=function(){if(!this._svg){return}var T=this._svg;var hX=this._map;var i=hX.config.drawMargin;var hU=hX.width+2*i;var e=hX.height+2*i;var hW=-hX.offsetX-i;var hV=-hX.offsetY-i;this.setAttribute(T,"x",hU+"px");this.setAttribute(T,"y",e+"px");this.setAttribute(T,"viewBox",hW+" "+hV+" "+hU+" "+e);var hT=T.style;hT.top=hV+"px";hT.left=hW+"px";hT.width=hU+"px";hT.height=e+"px"};bE.getPalette=function(){return this._svg};bE.setAttribute=function(hU,T,hV,hT,i){if(!hU){return}if(T==="strokestyle"){i=i||{};var hT=i.strokeWeight||4;var e=i.dashArray||null;switch(hV){case"dashed":if(e){hV=e.join(",")}else{hV=hT*2}break;case"dotted":if(i.strokeLineCap==="round"){hV="1,"+2*hT}else{hV=hT}break;default:hV=0;break}}var hW=hV||"none";if(hV===0){hW=0}hU.setAttributeNS(null,this._getAttributeName(T),hW);return hU};bE._getAttributeName=function(e){return this._svgAttrName[e]||e};bE.addLine=function(){var e=U("path",{},this.SVG_NS);this.setAttribute(e,"fill-rule","evenodd");this._svg.appendChild(e);return e};bE.setPath=function(T,e){var i=this._getPathString(e)||"M -9999,-9999";this.setAttribute(T,"d",i)};bE._getPathString=function(e){if(e.length===0){return""}var i=[];D.each(e,function(hU){if(hU.length<2){return}i.push("M "+hU[0].x+" "+hU[0].y+" L");for(var hT=1,T=hU.length;hT<T;hT++){i.push(hU[hT].x);i.push(hU[hT].y)}});return i.join(" ")};bE.addStandardCircle=function(){var e=U("circle",{},this.SVG_NS);this._svg.appendChild(e);return e};bE.setStandardCircleGeometry=function(T,hT){var i=hT.cx;var hU=hT.cy;var e=hT.radius;this.setAttribute(T,"cx",i);this.setAttribute(T,"cy",hU);this.setAttribute(T,"r",e)};function hz(e){this._map=e;this._vmlAttrName={strokeweight:"weight",strokecolor:"color",fillcolor:"color",strokeopacity:"opacity",fillopacity:"opacity",strokestyle:"dashstyle"};this._type="vml"}hz.prototype=new dW();var bj=hz.prototype;bj.setAttribute=function(T,e,hT){if(T){if(e.indexOf("stroke")==0){T=T.getElementsByTagName("stroke")[0]}else{if(e.indexOf("fill")==0){T=T.getElementsByTagName("fill")[0]}}if(e.indexOf("color")>0){if(!hT){T.on=false}else{T.on=true}}if(e=="strokestyle"){switch(hT){case"dashed":hT="4 2 1 2";break;case"dotted":hT="1 1";break;default:hT="solid";break}}if(e=="strokeweight"){hT=hT+"px"}var i=this._getAttributeName(e);T[i]=hT||""}};bj._getAttributeName=function(e){return this._vmlAttrName[e]||e};bj.addLine=function(){var e=[\'<v:shape style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;"\',\'coordsize="1,1" coordorigin="0,0" filled="t" fillcolor="white">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:shape>"].join("");return dJ(this._map.getPanes().mapPane,e)};bj.setPath=function(i,e){this.setAttribute(i,"path",this._getPathString(e));if(D.Browser.ie==6){i.style.display="none";i.style.display=""}};bj._getPathString=function(e){if(e.length==0){return""}var i=[];D.each(e,function(hU){if(hU.length<2){return}i.push("m "+hU[0].x+" "+hU[0].y+" l");for(var hT=1,T=hU.length;hT<T;hT++){i.push(hU[hT].x);i.push(hU[hT].y)}i.push("e")});return i.join(" ")||" "};bj.addStandardCircle=function(){var e=[\'<v:oval style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:oval>"].join("");return dJ(this._map.getPanes().mapPane,e)};bj.setStandardCircleGeometry=function(T,hT){var i=hT.cx;var hU=hT.cy;var e=hT.radius;T.style.left=(i-e)+"px";T.style.top=(hU-e)+"px";T.style.width=(e*2)+"px";T.style.height=(e*2)+"px";if(D.Browser.ie===6){T.style.display="none";T.style.display=""}};');